<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>象塔直播</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="layui/css/layui.css">
	<link rel="stylesheet" href="css/global.css">
	<link rel="stylesheet" href="css/main.css?v=1.1.3">
	<link rel="stylesheet" href="css/swiper.min.css">
</head>
<body>	
	<!-- <img src="images/loading.gif" class="loading" style="position:" alt=""> -->
	<div class="welcome"></div>
	<div id="auth-wrapper">
		<div class="auth-model">
			<div class="auth-model-tit">
				欢迎来到直播间
			</div>
			<div class="auth-model-body">
				<!-- <div>
					<input type="text">
				</div> -->
				<div>
					<button class="btn-default watchlive">立即观看</button>
				</div>
			</div>
		</div>
		<div class="auth-mask"></div>
	</div>
	<div id="redpacket-dialog" class="ctdialog">
		<div class="redpacket-wrapper">
			<div class="redpacked-xll-top">
				<div class="close"><img src="images/closeredpacket.png" alt="" class="response"></div>
					<div class="redpacked-tit">
						<p>送主播</p>
						<p>红包会把您最真挚的祝福送给主播</p>
					</div>
				<img src="images/redpacket-xxl-top.png" alt="" class="response">
			</div>
			<div class="redpacked-xll-body">
				<div>
					<!-- <input type="text" placeholder="恭喜发财，大吉大利" id="red-wish"> -->
					<ul class="money-choose">
						<!-- <li>1元</li>
						<li>5元</li>
						<li>10元</li>
						<li>15元</li>
						<li>100元</li> -->
						<!-- <li>其他金额</li> -->
					</ul>
					<div class="custom-money">
						<input type="number" placeholder="金额" id="moneysum" class="moneysum">
						<p>¥ <span>0.00</span></p>
					</div>
					<button class="sendmoney" id="sendmoney">塞钱进红包</button>
				</div>
				<!-- <img src="images/redpacket-xxl-body.png" alt="" class="response"> -->
			</div>
			<a href="withdraw.html" class="redpacked-xll-bottom">
				提现我抢到的红包
				<!-- <img src="images/redpacket-xxl-bottom.png" alt="" class="response"> -->
			</a>
		</div>
	</div>

	<div id="getredpacket" class="ctdialog">
		<div class="redpacket-wrapper">
			<div class="desc">
				<p>恭喜您获得元红包</p>
				<p>红包直接发送到您的账户中，请注意查收</p>
			</div>
			<a href="withdraw.html" class="redpacked-xll-bottom">
				提现我抢到的红包
			</a>
			<img src="images/getredpacket.png" class="response" alt="">
		</div>
	</div>
	<div id="redpacket-dialog-to-customer" class="ctdialog ">
		<div class="redpacket-wrapper">
			<div class="redpacked-xll-top">
				<div class="close"><img src="images/closeredpacket.png" alt="" class="response"></div>
					<div class="redpacked-tit">
						<p>抢红包</p>
						<p>拼手气红包，财源滚滚，好运不断</p>
					</div>
				<img src="images/redpacket-xxl-top.png" alt="" class="response">
			</div>
			<div class="redpacked-xll-body">
				<div>
					<input type="text" value="恭喜发财，大吉大利" id="red-wish">
					<div class="rptc">
						<input type="text" placeholder="红包个数" class="pocketnum">
						<input type="text" placeholder="金额" id="moneysumtocust">				
					</div>
					<!-- <div class="custom-money">
						<input type="number" placeholder="金额" id="moneysum" class="moneysum">
						<p>¥ <span>0.00</span></p>
					</div> -->
					<button class="sendmoney" id="tocustomer">塞钱进红包</button>
				</div>
				<!-- <img src="images/redpacket-xxl-body.png" alt="" class="response"> -->
			</div>
			<a href="withdraw.html" class="redpacked-xll-bottom">
				提现我抢到的红包
				<!-- <img src="images/redpacket-xxl-bottom.png" alt="" class="response"> -->
			</a>
		</div>
	</div>
	<div class="container">
		<section class="adv">
			<a href="javascript:;">
				<!-- <img src="images/adv.png" class="response" alt=""> -->
			</a>
		</section>
		<section class="player-wrapper" style="background:no-repeat center; background-size:cover">
			<div class="anchorheadimg"><!-- <img src="images/sharelogo.png" alt="" class="response"> --></div>
			<div class="numcount">0人</div>
			<!-- 直播未开始 -->
			<div class="countdown-wrapper">				
				<!-- <label class="countdown-label">直播倒计时</label>
				<div class="countdown">					
					<span class="num">0</span>
					<span class="num">0</span>					
					<span>:</span>					
					<span class="num">0</span>
					<span class="num">0</span>					
					<span>:</span>					
					<span class="num">0</span>
					<span class="num">0</span>					
				</div> -->
				<div class="countdownv2">倒计时 <span>0天00:00:00</span></div>
			</div>
			<!-- 直播视频-->
			<div id="player"></div>
			<!-- <img src="images/video.png" alt="" class="response"> -->
		</section>
		<section class="live-items">
			<!-- <div class="decorate"> -->
				<!-- <img src="images/rose.png" alt="" class="response"> -->
				<!-- <img src="images/rose.png" alt="" class="response"> -->
			<!-- </div> -->
			<ul class="hd">
				<!-- <li class="active">弹幕聊天</li>
				<li>排行榜单</li>
				<li>晚会详情</li>
				<li>联系我们</li> -->
			</ul>
			<div id="tabs-container" class="swiper-container">
				<div class='questionnaire'></div>
			    <div class="swiper-wrapper menutab">
			      <!-- <div class="swiper-slide swiper-no-swiping">
			        <div class="content-slide discuss-pannel">
			        	<ul class="message-list"> -->
			        		<!-- <li>
			        			<img src="http://wx.qlogo.cn/mmopen/dH8QVxmk2IXOezlo6KALUQqHlicM2xJoczZrLxib1fzGUN42e5FEibeKNeiccmRrs3ibM1xsszibPKSgiaruXibODZWpow/0" alt="" class="headimg fl">
			        			<div class="message fl">
			        				<div class="nickname">象塔直播</div>
			        				<p class="message-content">
			        					晚会好精彩
			        				</p>
			        			</div>
			        		</li>
			        		<li>
			        			<img src="http://wx.qlogo.cn/mmopen/dH8QVxmk2IXOezlo6KALUQqHlicM2xJoczZrLxib1fzGUN42e5FEibeKNeiccmRrs3ibM1xsszibPKSgiaruXibODZWpow/0" alt="" class="headimg fl">
			        			<div class="message fl">
			        				<div class="nickname">象塔直播</div>
			        				<p class="message-content redpacket-f">
			        					打赏给主播 7元 <img src="images/redpacket_s.png" class="redpacket-s" alt="">
			        				</p>
			        			</div>
			        		</li> -->
			        	<!-- </ul>			        	
			        	<div id="sth"></div>
			        </div>
			      </div> -->
			      <!-- <div class="swiper-slide swiper-no-swiping">
			        <div class="content-slide">
			         	<ul class="ranklist"> -->
			         		<!-- <li>
			         			<img src="http://wx.qlogo.cn/mmopen/dH8QVxmk2IXOezlo6KALUQqHlicM2xJoczZrLxib1fzGUN42e5FEibeKNeiccmRrs3ibM1xsszibPKSgiaruXibODZWpow/0" alt="" class="headimg fl">
			         			No.1 象塔直播
			         		</li>
			         	    -->
			         <!-- 	</ul>
			        </div>
			      </div> -->
			      <!-- <div class="swiper-slide swiper-no-swiping">
			        <div class="content-slide">
			        	这里是晚会详情的内容
			        </div>
			      </div>
			      <div class="swiper-slide swiper-no-swiping">
			        <div class="content-slide">
			        	这里是联系我们的内容
			        </div>
			      </div> -->
			    </div>
			  </div>
		</section>
		<section class="discuss-input-pannel">
			<div class="dip-warp">
				<div id="facelist">
					<ul></ul>
				</div>
				<div class="facebtn">
					<img src="images/facebtn.png" class="response" alt="">
				</div>
				<div class="callfunctionbtn">
					<img src="images/sendpicbtn.png" class="response" alt="">
				</div>
				<div class="discuss-input">
					<input type="text" id="msg-input">
					<!-- <div class="msg-input" contentEditable=true></div> -->
					<div class="sendbtn">
						<img src="images/sendbtn.png" class="response" alt="">
					</div>
				</div>
			</div>
			<div class="function-menu">
				<ul>
					<li id="gotocenter">
						<a href="javascript:;">
							<img src="images/usercentericon.png" class="response" alt="">
						</a>
					</li>
					<li id="pickfiles">
						<img src="images/sendpicicon.png" class="response" alt="">
					</li>					
				</ul>
			</div>
		</section>
		<div class="tocustomer">赏</div>
		<div class="redpacket-l">
			<img src="images/redpacket-l.png" alt="" class="response">
		</div>
	</div>
	<script src="js/jquery-1.9.1.min.js"></script>
	<script src="js/swiper.min.js"></script>
	<script src='js/webim/webim.config.js'></script>
	<script src='js/webim/strophe-1.2.8.min.js'></script>
	<script src='js/webim/websdk-1.4.7.js'></script>
	<script src='js/webim/xtwebim-c.js'></script>
	<script src='js/module_c.js'></script>
	<script src="http://cdn.aodianyun.com/static/jquery/jquery-1.7.2.min.js"></script>
	<script src="http://cdn.aodianyun.com/lss/aodianplay/player.js"></script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script src="layui/layui.js"></script>
	<script src='js/qiniu/bower_components/plupload/js/moxie.js'></script>
	<script src='js/qiniu/bower_components/plupload/js/plupload.dev.js'></script>
	<script src='js/qiniu/bower_components/qiniu/dist/qiniu.js'></script>
	<script>
	"use strict";

// $("#msg-input").click(function(){//表情输入体验优化
// 	console.log(document.getElementById("msg-input").selectionStart)
// });

var qiniu_token = "";

$(".facebtn").click(function () {
	handleControl.showEmoji();
});

window.onresize = function () {
	applicationInit.resizePlayer();
};

$(".tocustomer").click(function () {
	$(".moneysum").val('');
	$(".redpacked-xll-body").removeClass("showcustom");
	$("#redpacket-dialog").addClass('show');
});

$(".redpacket-l").click(function () {
	$("#redpacket-dialog-to-customer").addClass("show");
});

$(".close").click(function () {
	$(".ctdialog").removeClass("show");
});

xtAPI.wechatlogin();
// applicationInit.init();

$("#sendmoney").click(function () {
	var gift_id = $(".money-choose li[class=money-selected]").attr("data-gift-id");
	if (gift_id == 6) {
		wxPay.onBridgeReady(2, gift_id, Number($("#moneysum").val()).toFixed(2));
	} else {
		wxPay.onBridgeReady(2, gift_id);
	}
});

$("#tocustomer").click(function () {
	wxPay.sendtocustomer(Number($("#moneysumtocust").val()).toFixed(2), 1, $("#red-wish").val(), $(".pocketnum").val());
});

$("#getredpacket").click(function () {
	$(this).removeClass("show");
});

$("#moneysum").keyup(function () {
	var money_value = $(this).val();
	// var r = new RegExp(/^[0-9]*\.?[0-9]{0,2}$/);
	// console.log(r.test(money_value));
	$(".custom-money span").text(money_value);
});

$(".callfunctionbtn").click(function () {
	$(".function-menu").toggleClass("showfuntion");
});
//检查上传的照片格式是否正确
function checkFileType(dom) {
	var rt = false;
	layui.use(['layer'], function () {
		var layer = layui.layer;
		var filePath = dom.value;
		if (filePath) {
			var extname = filePath.substring(filePath.lastIndexOf(".") + 1, filePath.length).toLowerCase();
			if (extname != "bmp" && extname != "jpg" && extname != "gif" && extname != "png" && extname != "jpeg") {
				layer.msg("只能上传照片");
				rt = false;
			} else {
				if (dom.files[0].size / 1024 > 15000) {
					layer.msg("图片不能大于15M");
					rt = false;
				}
				rt = true;
			}
		} else {
			//     //layer.msg("请上传照片");
			rt = false;
		}
	});
	return rt;
}

$("input[name='sendpic']").change(function () {
	var pic = $("input[name='sendpic']");
	if (checkFileType(pic[0])) {
		layui.use(['layer'], function () {
			layer.open({
				title: '发送图片',
				area: ['80%', '80%'],
				content: '<div style="justify-content: center;display: flex;align-items: center;height: 100%; margin-bottom:0"><img src="" id="previewsend" /></div>'
				// ,content: `<div style="justify-content: center;display: flex;align-items: center;height: 100%; margin-bottom:0"><img src="" id="previewsend" /></div>`
				, closeBtn: 0,
				btn: ['发送', '取消'],
				yes: function yes(index, layero) {
					layer.close(index);
				}
			});
		});
		var oFile = pic[0].files[0];
		var oReader = new FileReader();
		oReader.onload = function (e) {
			$("#previewsend").attr("src", e.target.result);
		};
		oReader.readAsDataURL(oFile);
	}
});
var getoken = new Promise(function (resolve) {
	$.post(xtAPI.commonUrl + "newlive/mImhistory/getImgUptoken.do", function (d) {
		qiniu_token = d["data"]["uptoken"];
		var uploader = Qiniu.uploader({
			runtimes: 'html5,flash,html4', // 上传模式,依次退化
			browse_button: 'pickfiles', // 上传选择的点选按钮，**必需**
			// 在初始化时，uptoken, uptoken_url, uptoken_func 三个参数中必须有一个被设置
			// 切如果提供了多个，其优先级为 uptoken > uptoken_url > uptoken_func
			// 其中 uptoken 是直接提供上传凭证，uptoken_url 是提供了获取上传凭证的地址，如果需要定制获取 uptoken 的过程则可以设置 uptoken_func
			uptoken: qiniu_token, // uptoken 是上传凭证，由其他程序生成
			// uptoken_url: '/uptoken',         // Ajax 请求 uptoken 的 Url，**强烈建议设置**（服务端提供）
			// uptoken_func: function(file){    // 在需要获取 uptoken 时，该方法会被调用
			//    // do something
			//    return uptoken;
			// },
			get_new_uptoken: false, // 设置上传文件的时候是否每次都重新获取新的 uptoken
			// downtoken_url: '/downtoken',
			// Ajax请求downToken的Url，私有空间时使用,JS-SDK 将向该地址POST文件的key和domain,服务端返回的JSON必须包含`url`字段，`url`值为该文件的下载地址
			unique_names: true,              // 默认 false，key 为文件名。若开启该选项，JS-SDK 会为每个文件自动生成key（文件名）
			// save_key: true,                  // 默认 false。若在服务端生成 uptoken 的上传策略中指定了 `sava_key`，则开启，SDK在前端将不对key进行任何处理
			domain: 'http://img.xiangtazhibo.com/', // bucket 域名，下载资源时用到，如：'http://xxx.bkt.clouddn.com/' **必需**
			// container: 'container',             // 上传区域 DOM ID，默认是 browser_button 的父元素，
			max_file_size: '100mb', // 最大文件体积限制
			flash_swf_url: 'path/of/plupload/Moxie.swf', //引入 flash,相对路径
			max_retries: 3, // 上传失败最大重试次数
			dragdrop: false, // 开启可拖曳上传
			drop_element: 'container', // 拖曳上传区域元素的 ID，拖曳文件或文件夹后可触发上传
			chunk_size: '4mb', // 分块上传时，每块的体积
			auto_start: true, // 选择文件后自动上传，若关闭需要自己绑定事件触发上传,
			multi_selection: false,
			//x_vars : {
			//    自定义变量，参考http://developer.qiniu.com/docs/v6/api/overview/up/response/vars.html
			//    'time' : function(up,file) {
			//        var time = (new Date()).getTime();
			// do something with 'time'
			//        return time;
			//    },
			//    'size' : function(up,file) {
			//        var size = file.size;
			// do something with 'size'
			//        return size;
			//    }
			//},
			init: {
				'FilesAdded': function FilesAdded(up, files) {
					plupload.each(files, function (file) {
						// 文件添加进队列后,处理相关的事情
					});
				},
				'BeforeUpload': function BeforeUpload(up, file) {
					// 每个文件上传前,处理相关的事情
				},
				'UploadProgress': function UploadProgress(up, file) {
					// 每个文件上传时,处理相关的事情
				},
				'FileUploaded': function FileUploaded(up, file, info) {
					// 每个文件上传成功后,处理相关的事情
					// 其中 info 是文件上传成功后，服务端返回的json，形式如
					// {
					//    "hash": "Fh8xVqod2MQ1mocfI4S4KpRL6D98",
					//    "key": "gogopher.jpg"
					//  }
					// 参考http://developer.qiniu.com/docs/v6/api/overview/up/response/simple-response.html

					var domain = up.getOption('domain');
					var res = $.parseJSON(info);
					var sourceLink = domain + res.key; //获取上传成功后的文件的Url
					easemob.sendToAPI(sourceLink, 7);
					$(".function-menu").removeClass("showfuntion");
				},
				'Error': function Error(up, err, errTip) {
					//上传出错时,处理相关的事情
				},
				'UploadComplete': function UploadComplete() {
					//队列文件处理完毕后,处理相关的事情
				}
			}
		});
	});
});

	</script>
</body>
</html>